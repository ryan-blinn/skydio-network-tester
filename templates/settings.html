<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Skydio Network Readiness Tester</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='images/favicon.svg') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}?v=2.1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}?v=2.1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="brand-lockup">
                        <img src="{{ url_for('static', filename='images/skydio-mark.png') }}" alt="Skydio" class="skydio-mark-logo">
                        <img src="{{ url_for('static', filename='images/skydio-logo-white.svg') }}" alt="Skydio" class="skydio-logo">
                    </div>
                    <h1><i class="fas fa-cog"></i> System Configuration</h1>
                </div>
                <div class="header-controls">
                    <div class="device-info">
                        <span><img class="device-info-icon" src="{{ url_for('static', filename='images/skydio-mark.png') }}" alt="Skydio"> <span id="private-ip">Loading...</span></span>
                        <span><i class="fas fa-globe"></i> <span id="public-ip">Loading...</span></span>
                    </div>
                    <button class="back-btn" onclick="window.location.href='/'">
                        <i class="fas fa-arrow-left"></i> Back to Tests
                    </button>
                </div>
            </div>
        </div>

        <div id="local-access-warning" class="access-notice" style="display:none; margin-top: 12px;">
            <i class="fas fa-lock"></i>
            Local-only controls are disabled from remote browsers. Open this page on the device screen using <strong>http://localhost:5001/settings</strong>.
        </div>

        <!-- Settings Content -->
        <div class="settings-content">
            <!-- Navigation Menu -->
            <div class="settings-nav">
                <div class="nav-item active" data-section="system">
                    <i class="fas fa-microchip"></i>
                    <span>System Information</span>
                </div>
                <div class="nav-item" data-section="network">
                    <i class="fas fa-network-wired"></i>
                    <span>Network Configuration</span>
                </div>
                <div class="nav-item" data-section="testing">
                    <i class="fas fa-flask"></i>
                    <span>Test Configuration</span>
                </div>
                <div class="nav-item" data-section="export">
                    <i class="fas fa-download"></i>
                    <span>Export & Upload</span>
                </div>
                <div class="nav-item" data-section="api">
                    <i class="fas fa-plug"></i>
                    <span>Integrations</span>
                </div>
                <div class="nav-item" data-section="advanced">
                    <i class="fas fa-tools"></i>
                    <span>Advanced Options</span>
                </div>
            </div>

            <!-- Settings Panels -->
            <div class="settings-panels">
                <!-- System Information Panel -->
                <div class="settings-panel active" id="system-panel" style="display: block;">
                    <h2><i class="fas fa-microchip"></i> System Information</h2>
                    
                    <div class="setting-group">
                        <h3>Device Identity</h3>
                        <div class="setting-item">
                            <label for="hostname">Hostname</label>
                            <div class="input-group">
                                <input type="text" id="hostname" placeholder="SkydioNT-XXXX or site-lab-01">
                                <button class="btn-secondary" onclick="updateHostname()" data-local-only="true">
                                    <i class="fas fa-save"></i> Update
                                </button>
                            </div>
                            <small>Device hostname (requires reboot)</small>
                            <small>Change sparingly and only when approved by Skydio, Inc.</small>
                        </div>
                        
                        <div class="setting-item">
                            <label>System Status</label>
                            <div class="status-grid">
                                <div class="status-item">
                                    <span class="status-label">CPU Usage</span>
                                    <span class="status-value" id="cpu-usage">Loading...</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Memory Usage</span>
                                    <span class="status-value" id="memory-usage">Loading...</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Disk Usage</span>
                                    <span class="status-value" id="disk-usage">Loading...</span>
                                </div>
                                <div class="status-item">
                                    <span class="status-label">Uptime</span>
                                    <span class="status-value" id="uptime">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Network Report Information</h3>
                        <p style="color: #666; margin-bottom: 1rem;">The following information is included in all exported network reports (PDF, CSV, JSON):</p>
                        
                        <div class="info-section">
                            <h4><i class="fas fa-info-circle"></i> Device Metadata</h4>
                            <ul class="info-list">
                                <li><strong>Device Name:</strong> Hostname of the testing device</li>
                                <li><strong>Private IP Address:</strong> Local network IP address of the Raspberry Pi</li>
                                <li><strong>Public IP Address:</strong> External IP address</li>
                                <li><strong>Site Label:</strong> Optional custom label for the test location</li>
                                <li><strong>Timestamp:</strong> Date and time of test execution</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h4><i class="fas fa-search"></i> DNS Resolution Tests</h4>
                            <ul class="info-list">
                                <li><strong>Target Domains:</strong> List of domains tested (skydio.com, cloud.skydio.com, google.com, 8.8.8.8)</li>
                                <li><strong>Resolution Status:</strong> PASS/FAIL for each domain</li>
                                <li><strong>Resolved IP:</strong> IP address returned by DNS lookup</li>
                                <li><strong>Latency:</strong> DNS query response time in milliseconds</li>
                                <li><strong>Error Details:</strong> Specific error messages if resolution fails</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h4><i class="fas fa-plug"></i> TCP Connectivity Tests</h4>
                            <ul class="info-list">
                                <li><strong>Target Hosts:</strong> Skydio services and ports (443 for HTTPS)</li>
                                <li><strong>Connection Status:</strong> PASS/FAIL for each endpoint</li>
                                <li><strong>Connection Latency:</strong> Time to establish TCP connection</li>
                                <li><strong>Service Labels:</strong> Descriptive names for each endpoint</li>
                                <li><strong>Error Details:</strong> Connection timeout or refusal information</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h4><i class="fas fa-bolt"></i> QUIC Protocol Tests</h4>
                            <ul class="info-list">
                                <li><strong>Target Hosts:</strong> HTTP/3 enabled Skydio endpoints</li>
                                <li><strong>Protocol Status:</strong> PASS/FAIL for QUIC connectivity</li>
                                <li><strong>Port Information:</strong> UDP port 443 for QUIC</li>
                                <li><strong>Error Details:</strong> Protocol-specific failure information</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h4><i class="fas fa-satellite-dish"></i> Ping Tests</h4>
                            <ul class="info-list">
                                <li><strong>Target Hosts:</strong> Key internet endpoints (8.8.8.8, 1.1.1.1, skydio.com)</li>
                                <li><strong>Latency Metrics:</strong> Average, minimum, and maximum ping times</li>
                                <li><strong>Packet Loss:</strong> Percentage of lost packets</li>
                                <li><strong>Status:</strong> PASS/FAIL based on reachability</li>
                                <li><strong>Raw Output:</strong> Complete ping command results</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h4><i class="fas fa-clock"></i> NTP Time Synchronization</h4>
                            <ul class="info-list">
                                <li><strong>NTP Server:</strong> time.skydio.com or configured server</li>
                                <li><strong>Sync Status:</strong> PASS/FAIL for time synchronization</li>
                                <li><strong>Time Offset:</strong> Difference from NTP server in milliseconds</li>
                                <li><strong>Error Details:</strong> Connection or synchronization failures</li>
                            </ul>
                        </div>

                        <div class="info-section">
                            <h4><i class="fas fa-tachometer-alt"></i> Speed Test</h4>
                            <ul class="info-list">
                                <li><strong>Download Speed:</strong> Measured in Mbps (Ookla CLI or Cloudflare fallback)</li>
                                <li><strong>Upload Speed:</strong> Measured in Mbps</li>
                                <li><strong>Status Thresholds:</strong> PASS (â‰¥20 Mbps), WARN (10-20 Mbps), FAIL (<10 Mbps)</li>
                                <li><strong>Test Method:</strong> Ookla Speedtest CLI or Cloudflare API</li>
                                <li><strong>Error Details:</strong> Test execution failures</li>
                            </ul>
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>System Actions</h3>
                        <div class="action-buttons">
                            <button class="btn-warning" onclick="rebootSystem()" data-local-only="true">
                                <i class="fas fa-redo"></i> Reboot System
                            </button>
                            <button class="btn-secondary" onclick="updateSystem()" data-local-only="true">
                                <i class="fas fa-download"></i> Update System
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Network Configuration Panel -->
                <div class="settings-panel" id="network-panel" style="display: none;">
                    <h2><i class="fas fa-network-wired"></i> Network Configuration</h2>
                    
                    <div class="setting-group">
                        <h3>Current Connection Status</h3>
                        <div class="network-status-grid">
                            <div class="network-status-item">
                                <label>Hostname</label>
                                <div id="net-hostname">Loading...</div>
                            </div>
                            <div class="network-status-item">
                                <label>Private IP</label>
                                <div id="net-private-ip">Loading...</div>
                            </div>
                            <div class="network-status-item">
                                <label>Public IP</label>
                                <div id="net-public-ip">Loading...</div>
                            </div>
                            <div class="network-status-item">
                                <label>Connection</label>
                                <div id="net-connection">Loading...</div>
                            </div>
                            <div class="network-status-item">
                                <label>Gateway</label>
                                <div id="net-gateway">Loading...</div>
                            </div>
                            <div class="network-status-item">
                                <label>DNS</label>
                                <div id="net-dns">Loading...</div>
                            </div>
                        </div>
                        <div id="wifi-status" class="wifi-status-display" style="margin-top: 1rem;">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Interface Configuration</h3>
                        <div class="interface-tabs">
                            <button class="tab-btn active" data-interface="eth0">Ethernet</button>
                            <button class="tab-btn" data-interface="wlan0">WiFi</button>
                        </div>
                        
                        <div class="interface-config" id="eth0-config">
                            <div class="setting-item">
                                <label>Detected (Ethernet)</label>
                                <div class="network-status-grid">
                                    <div class="network-status-item">
                                        <label>Link/State</label>
                                        <div id="eth0-state">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>Connection Profile</label>
                                        <div id="eth0-connection">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>MAC</label>
                                        <div id="eth0-mac">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>MTU</label>
                                        <div id="eth0-mtu">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>IPv4</label>
                                        <div id="eth0-ipv4">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>Gateway</label>
                                        <div id="eth0-gw">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>DNS</label>
                                        <div id="eth0-dns-detected">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>Method</label>
                                        <div id="eth0-method">Loading...</div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-item">
                                <label>Configuration Mode</label>
                                <select id="eth0-mode" onchange="toggleNetworkMode('eth0')">
                                    <option value="dhcp">DHCP (Automatic)</option>
                                    <option value="static">Static IP</option>
                                </select>
                            </div>
                            
                            <div class="static-config" id="eth0-static" style="display: none;">
                                <div class="setting-item">
                                    <label for="eth0-ip">IP Address</label>
                                    <input type="text" id="eth0-ip" placeholder="192.168.1.100">
                                </div>
                                <div class="setting-item">
                                    <label for="eth0-netmask">Subnet Mask</label>
                                    <input type="text" id="eth0-netmask" placeholder="255.255.255.0">
                                </div>
                                <div class="setting-item">
                                    <label for="eth0-gateway">Gateway</label>
                                    <input type="text" id="eth0-gateway" placeholder="192.168.1.1">
                                </div>
                                <div class="setting-item">
                                    <label for="eth0-dns">DNS Servers</label>
                                    <input type="text" id="eth0-dns" placeholder="8.8.8.8, 1.1.1.1">
                                </div>
                            </div>

                            <div class="action-buttons" style="margin-top: 1rem;">
                                <button class="btn-primary" onclick="applyInterfaceConfig('eth0')" data-local-only="true">
                                    <i class="fas fa-save"></i> Apply Ethernet Settings
                                </button>
                            </div>
                        </div>
                        
                        <div class="interface-config" id="wlan0-config" style="display: none;">
                            <div class="setting-item">
                                <label>Detected (WiFi)</label>
                                <div class="network-status-grid">
                                    <div class="network-status-item">
                                        <label>Link/State</label>
                                        <div id="wlan0-state">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>Connection Profile</label>
                                        <div id="wlan0-connection">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>SSID</label>
                                        <div id="wlan0-ssid">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>Signal</label>
                                        <div id="wlan0-signal">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>IPv4</label>
                                        <div id="wlan0-ipv4">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>Gateway</label>
                                        <div id="wlan0-gw">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>DNS</label>
                                        <div id="wlan0-dns-detected">Loading...</div>
                                    </div>
                                    <div class="network-status-item">
                                        <label>Method</label>
                                        <div id="wlan0-method">Loading...</div>
                                    </div>
                                </div>
                            </div>

                            <div class="setting-item">
                                <button class="btn-secondary" onclick="window.settingsManager.scanWiFiNetworks()" data-local-only="true" style="width: 100%; margin-bottom: 1rem;">
                                    <i class="fas fa-search"></i> Scan for WiFi Networks
                                </button>
                            </div>
                            
                            <div id="wifi-networks-list" class="wifi-networks-container" style="margin-bottom: 1.5rem;">
                                <p style="color: #666; text-align: center;">Click "Scan for WiFi Networks" to see available networks</p>
                            </div>
                            
                            <div class="setting-item">
                                <label for="wifi-ssid">WiFi Network (SSID)</label>
                                <input type="text" id="wifi-ssid" placeholder="Network Name" data-local-only="true">
                                <small>Enter network name or select from scan results above</small>
                            </div>
                            <div class="setting-item">
                                <label for="wifi-password">WiFi Password</label>
                                <input type="password" id="wifi-password" placeholder="Password" data-local-only="true">
                                <small>Leave blank for open networks</small>
                            </div>
                            <div class="setting-item">
                                <label>Configuration Mode</label>
                                <select id="wlan0-mode" onchange="toggleNetworkMode('wlan0')">
                                    <option value="dhcp">DHCP (Automatic)</option>
                                    <option value="static">Static IP</option>
                                </select>
                            </div>

                            <div class="static-config" id="wlan0-static" style="display: none;">
                                <div class="setting-item">
                                    <label for="wlan0-ip">IP Address</label>
                                    <input type="text" id="wlan0-ip" placeholder="192.168.1.100" data-local-only="true">
                                </div>
                                <div class="setting-item">
                                    <label for="wlan0-netmask">Subnet Mask</label>
                                    <input type="text" id="wlan0-netmask" placeholder="255.255.255.0" data-local-only="true">
                                </div>
                                <div class="setting-item">
                                    <label for="wlan0-gateway">Gateway</label>
                                    <input type="text" id="wlan0-gateway" placeholder="192.168.1.1" data-local-only="true">
                                </div>
                                <div class="setting-item">
                                    <label for="wlan0-dns">DNS Servers</label>
                                    <input type="text" id="wlan0-dns" placeholder="8.8.8.8, 1.1.1.1" data-local-only="true">
                                </div>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn-primary" onclick="saveNetworkConfig()" data-local-only="true">
                                <i class="fas fa-save"></i> Connect to Network
                            </button>
                            <button class="btn-secondary" onclick="applyInterfaceConfig('wlan0')" data-local-only="true" style="margin-left: 10px;">
                                <i class="fas fa-save"></i> Apply WiFi IP Settings
                            </button>
                            <button class="btn-secondary" onclick="disconnectWiFi()" data-local-only="true" style="margin-left: 10px;">
                                <i class="fas fa-unlink"></i> Disconnect WiFi
                            </button>
                        </div>

                        <div class="setting-item" style="margin-top: 1rem;">
                            <button class="btn-secondary" onclick="loadSavedWiFiNetworks()" data-local-only="true" style="width: 100%;">
                                <i class="fas fa-list"></i> Show Saved WiFi Networks
                            </button>
                        </div>
                        <div id="wifi-saved-list" class="wifi-networks-container" style="display:none; margin-top: 0.75rem;"></div>
                    </div>
                </div>

                <!-- Test Configuration Panel -->
                <div class="settings-panel" id="testing-panel" style="display: none;">
                    <h2><i class="fas fa-flask"></i> Test Configuration</h2>
                    
                    <div class="setting-group">
                        <h3>Automatic Testing</h3>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="auto-test-enabled">
                                <span class="checkmark"></span>
                                Enable automatic testing on network changes
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label for="max-auto-tests">Maximum Auto Tests</label>
                            <input type="number" id="max-auto-tests" min="1" max="10" value="3">
                            <small>Number of tests to run when network changes detected</small>
                        </div>
                        
                        <div class="setting-item">
                            <label for="test-interval">Test Interval (seconds)</label>
                            <input type="number" id="test-interval" min="60" max="3600" value="300">
                            <small>Time between automatic tests</small>
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Test Targets</h3>
                        <div class="target-config">
                            <h4>DNS Servers</h4>
                            <textarea id="dns-targets" rows="3" placeholder="cloud.skydio.com&#10;time.skydio.com&#10;google.com"></textarea>
                            
                            <h4>TCP Ports</h4>
                            <div class="tcp-targets" id="tcp-targets">
                                <!-- TCP targets will be populated by JavaScript -->
                            </div>
                            <button class="btn-secondary" onclick="addTcpTarget()">
                                <i class="fas fa-plus"></i> Add TCP Target
                            </button>
                            
                            <h4>Ping Targets</h4>
                            <textarea id="ping-targets" rows="3" placeholder="8.8.8.8&#10;1.1.1.1&#10;cloud.skydio.com"></textarea>
                            
                            <h4>NTP Server</h4>
                            <input type="text" id="ntp-target" placeholder="time.skydio.com">
                        </div>
                        
                        <button class="btn-primary" onclick="saveTestConfig()" data-local-only="true">
                            <i class="fas fa-save"></i> Save Test Configuration
                        </button>
                    </div>
                </div>

                <!-- Export & Upload Panel -->
                <div class="settings-panel" id="export-panel" style="display: none;">
                    <h2><i class="fas fa-download"></i> Export & Upload Settings</h2>
                    
                    <div class="setting-group">
                        <h3>Automatic Export</h3>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="auto-export-enabled">
                                <span class="checkmark"></span>
                                Automatically export results after each test
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label for="auto-export-format">Export Format</label>
                            <select id="auto-export-format">
                                <option value="pdf">PDF Report</option>
                                <option value="csv">CSV Data</option>
                                <option value="json">JSON Data</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>Remote Upload</h3>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="webhook-enabled">
                                <span class="checkmark"></span>
                                Send results to webhook URL
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label for="webhook-url">Webhook URL</label>
                            <input type="url" id="webhook-url" placeholder="https://your-server.com/webhook">
                            <small>Results will be POST'd as JSON to this URL</small>
                        </div>
                        
                        <div class="setting-item">
                            <label for="webhook-auth">Authorization Header</label>
                            <input type="text" id="webhook-auth" placeholder="Bearer your-token">
                            <small>Optional authentication header</small>
                        </div>
                        
                        <button class="btn-secondary" onclick="testWebhook()" data-local-only="true">
                            <i class="fas fa-paper-plane"></i> Test Webhook
                        </button>
                    </div>

                    <div class="setting-group">
                        <h3>FTP Upload</h3>
                        <small style="display:block; color:#666; margin-top:-0.25rem; margin-bottom:0.75rem;">FTP upload is not implemented yet. This section is disabled to avoid confusion.</small>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="ftp-enabled" disabled>
                                <span class="checkmark"></span>
                                Upload results to FTP server
                            </label>
                        </div>
                        
                        <div class="ftp-config" id="ftp-config" style="display: none;">
                            <div class="setting-item">
                                <label for="ftp-host">FTP Host</label>
                                <input type="text" id="ftp-host" placeholder="ftp.example.com" disabled>
                            </div>
                            <div class="setting-item">
                                <label for="ftp-username">Username</label>
                                <input type="text" id="ftp-username" placeholder="username" disabled>
                            </div>
                            <div class="setting-item">
                                <label for="ftp-password">Password</label>
                                <input type="password" id="ftp-password" placeholder="password" disabled>
                            </div>
                            <div class="setting-item">
                                <label for="ftp-path">Remote Path</label>
                                <input type="text" id="ftp-path" placeholder="/uploads/" disabled>
                            </div>
                            <div class="setting-group">
                                <h3>Device Information</h3>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>Device ID</label>
                                        <span id="device-id">Loading...</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Hostname</label>
                                        <span id="device-hostname">Loading...</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Platform</label>
                                        <span id="device-platform">Loading...</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Architecture</label>
                                        <span id="device-architecture">Loading...</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Uptime</label>
                                        <span id="device-uptime">Loading...</span>
                                    </div>
                                    <div class="info-item">
                                        <label>CPU Usage</label>
                                        <span id="cpu-usage">Loading...</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Memory Usage</label>
                                        <span id="memory-usage">Loading...</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Disk Usage</label>
                                        <span id="disk-usage">Loading...</span>
                                    </div>
                                    <div class="info-item">
                                        <label>CPU Temperature</label>
                                        <span id="cpu-temperature">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn-primary" onclick="saveExportConfig()" data-local-only="true">
                            <i class="fas fa-save"></i> Save Export Configuration
                        </button>
                    </div>
                </div>

                <!-- API Settings Panel -->
                <div class="settings-panel" id="api-panel" style="display: none;">
                    <h2><i class="fas fa-plug"></i> Integrations</h2>
                    
                    <div class="setting-group">
                        <h3>Cloud Integration</h3>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="cloud-push-enabled">
                                <span class="checkmark"></span>
                                Enable automatic cloud push
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label for="cloud-api-url">Cloud API URL</label>
                            <input type="url" id="cloud-api-url" placeholder="https://api.example.com/network-results">
                        </div>
                        
                        <div class="setting-item">
                            <label for="cloud-api-key">API Key</label>
                            <input type="password" id="cloud-api-key" placeholder="Enter API key">
                        </div>
                        
                        <button class="btn-secondary" onclick="testCloudConnection()" data-local-only="true">
                            <i class="fas fa-satellite-dish"></i> Test Connection
                        </button>
                    </div>
                    
                    <div class="setting-group">
                        <h3>Databricks Integration</h3>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="databricks-enabled">
                                <span class="checkmark"></span>
                                Enable Databricks integration
                            </label>
                        </div>
                        
                        <div class="databricks-config" id="databricks-config" style="display: none;">
                            <div class="setting-item">
                                <label for="databricks-workspace-url">Workspace URL</label>
                                <input type="url" id="databricks-workspace-url" placeholder="https://your-workspace.cloud.databricks.com">
                                <small>Your Databricks workspace URL</small>
                            </div>
                            
                            <div class="setting-item">
                                <label for="databricks-access-token">Access Token</label>
                                <input type="password" id="databricks-access-token" placeholder="Enter access token">
                                <small>Personal access token for authentication</small>
                            </div>
                            
                            <div class="setting-item">
                                <label for="databricks-warehouse-id">SQL Warehouse ID</label>
                                <input type="text" id="databricks-warehouse-id" placeholder="Enter warehouse ID">
                                <small>SQL warehouse ID for query execution</small>
                            </div>
                            
                            <div class="setting-item">
                                <label for="databricks-database">Database Name</label>
                                <input type="text" id="databricks-database" value="network_tests" placeholder="network_tests">
                                <small>Database to store test results</small>
                            </div>
                            
                            <div class="setting-item">
                                <label for="databricks-table">Table Name</label>
                                <input type="text" id="databricks-table" value="test_results" placeholder="test_results">
                                <small>Table to store test results</small>
                            </div>
                            
                            <div class="setting-item">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="databricks-auto-push">
                                    <span class="checkmark"></span>
                                    Automatically push results after each test
                                </label>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn-secondary" onclick="testDatabricksConnection()" data-local-only="true">
                                <i class="fas fa-database"></i> Test Connection
                            </button>
                            <button class="btn-secondary" onclick="pushToDatabricks()" data-local-only="true" style="margin-left: 10px;">
                                <i class="fas fa-upload"></i> Push Latest Results
                            </button>
                        </div>
                        
                        <button class="btn-primary" onclick="saveDatabricksConfig()" data-local-only="true">
                            <i class="fas fa-save"></i> Save Databricks Configuration
                        </button>
                    </div>
                    
                    <div class="setting-group">
                        <h3>Web Interface</h3>
                        <div class="setting-item">
                            <label for="web-port">Web Interface Port</label>
                            <input type="number" id="web-port" min="1024" max="65535" value="5001">
                            <small>Port for web interface (requires restart)</small>
                        </div>
                        
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="web-auth-enabled">
                                <span class="checkmark"></span>
                                Enable basic authentication
                            </label>
                        </div>
                        
                        <div class="auth-config" id="auth-config" style="display: none;">
                            <div class="setting-item">
                                <label for="web-username">Username</label>
                                <input type="text" id="web-username" placeholder="admin">
                            </div>
                            <div class="setting-item">
                                <label for="web-password">Password</label>
                                <input type="password" id="web-password" placeholder="password">
                            </div>
                        </div>

                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="allow-remote-admin" data-local-only="true">
                                <span class="checkmark"></span>
                                Allow admin changes from remote browsers
                            </label>
                            <small>When enabled, Settings actions can be performed from non-localhost clients.</small>
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>API Access</h3>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="api-enabled">
                                <span class="checkmark"></span>
                                Enable REST API access
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <label for="api-key">API Key</label>
                            <div class="input-group">
                                <input type="text" id="api-key" readonly>
                                <button class="btn-secondary" onclick="generateApiKey()" data-local-only="true">
                                    <i class="fas fa-refresh"></i> Generate
                                </button>
                            </div>
                            <small>Required for API access when enabled</small>
                        </div>
                        
                        <button class="btn-primary" onclick="saveApiConfig()" data-local-only="true">
                            <i class="fas fa-save"></i> Save API Configuration
                        </button>
                    </div>
                </div>

                <!-- Advanced Options Panel -->
                <div class="settings-panel" id="advanced-panel" style="display: none;">
                    <h2><i class="fas fa-tools"></i> Advanced Options</h2>

                    <div class="advanced-grid">
                        <div class="advanced-card">
                            <div class="advanced-card-header">
                                <i class="fas fa-file-alt"></i>
                                <div>
                                    <h3>Logs</h3>
                                    <p>View or download system logs for troubleshooting.</p>
                                </div>
                            </div>
                            <div class="advanced-card-actions">
                                <button class="btn-secondary" onclick="viewLogs()" data-local-only="true">
                                    <i class="fas fa-eye"></i> View Logs
                                </button>
                                <button class="btn-warning" onclick="downloadLogs()" data-local-only="true">
                                    <i class="fas fa-download"></i> Download Logs
                                </button>
                            </div>
                        </div>

                        <div class="advanced-card">
                            <div class="advanced-card-header">
                                <i class="fas fa-database"></i>
                                <div>
                                    <h3>Configuration Backup</h3>
                                    <p>Download a backup or restore configuration from a file.</p>
                                </div>
                            </div>
                            <div class="advanced-card-actions">
                                <button class="btn-secondary" onclick="backupConfig()" data-local-only="true">
                                    <i class="fas fa-download"></i> Download Backup
                                </button>
                                <button class="btn-secondary" onclick="document.getElementById('restore-file').click()" data-local-only="true">
                                    <i class="fas fa-upload"></i> Restore Backup
                                </button>
                                <input type="file" id="restore-file" style="display: none;" accept=".json" onchange="restoreConfig(this)">
                            </div>
                        </div>

                        <div class="advanced-card advanced-card-danger">
                            <div class="advanced-card-header">
                                <i class="fas fa-exclamation-triangle"></i>
                                <div>
                                    <h3>Factory Reset</h3>
                                    <p>Resets all settings to defaults and reboots the system.</p>
                                </div>
                            </div>
                            <div class="advanced-card-actions">
                                <button class="btn-danger" onclick="factoryReset()" data-local-only="true">
                                    <i class="fas fa-trash"></i> Factory Reset
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/settings.js') }}?v=2.1"></script>
</body>
</html>
